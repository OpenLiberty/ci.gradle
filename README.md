# ci.gradle [![Build Status](https://travis-ci.org/WASdev/ci.gradle.svg?branch=master)](https://travis-ci.org/WASdev/ci.gradle) [![Maven Central Latest](https://maven-badges.herokuapp.com/maven-central/net.wasdev.wlp.gradle.plugins/liberty-gradle-plugin/badge.svg)](http://search.maven.org/#search%7Cgav%7C1%7Cg%3A%22net.wasdev.wlp.gradle.plugins%22%20AND%20a%3A%22liberty-gradle-plugin%22)

The Liberty Gradle plugin supports install and operational control of WebSphere Liberty runtime and servers. Use it to manage your application on Liberty for integration test and to create Liberty server packages.

* [Build](#build)
* [Usage](#usage)
* [Plugin Configuration](#plugin-configuration)
* [Tasks](#tasks)


## Build

Clone this repository and then, with a JRE on the path, execute the following command in the root directory.

```bash
$ gradlew build
```

This will download Gradle and then build the plugin `liberty-gradle-plugin-1.1-SNAPSHOT.jar` in to the `build\libs` directory. It is also possible to install the plugin in to your local Maven repository using `gradlew install`.

To build the plugin and run the integration tests execute the following commands in the root directory.

1. To run the integration tests using an existing WebSphere Liberty server installation.
 ```bash
 $ gradlew build -Prunit=offline -DwlpInstallDir=<liberty_install_directory>
 ```

2. To run the integration tests against an automatically downloaded and installed WebSphere Liberty server. The `wlpLicense` parameter is only needed for Liberty packaged as a JAR file.
 ```bash
 $ gradlew build -Prunit=online -DwlpLicense=<liberty_licesnse_code> -DwlpVersion=<liberty_version>
 ```

## Usage
### Configuring your dependencies

####  Adding the Ant plugin to the build script
This plugin needs the `wlp-anttasks.jar`file as a dependency, this file can be downloaded from the [snapshot repository](https://oss.sonatype.org/content/repositories/snapshots/net/wasdev/wlp/ant/wlp-anttasks/) or the [Maven central repository](http://repo1.maven.org/maven2/net/wasdev/wlp/ant/wlp-anttasks/).

The following code snippet shows an example for how to set up your build script correctly.
```groovy
buildscript {
    dependencies {
        classpath files('gradle/wlp-anttasks.jar')
    }
}
```


### Adding the binary plugin to the build script

Within your Gradle build script, you need to set up the classpath to include the Liberty Gradle plugin. You also need to define the Maven Central repository to find the plugin or its dependencies.

If you are using a snapshot version of the plugin make sure to define the Sonatype Nexus Snapshots repository in addition to the Maven Central repository.

Your build script should look like this:

```groovy
buildscript {
    repositories {
        mavenCentral()
        maven {
            name = 'Sonatype Nexus Snapshots'
            url = 'https://oss.sonatype.org/content/repositories/snapshots/'
        }
    }
    dependencies {
        classpath 'net.wasdev.wlp.gradle.plugins:liberty-gradle-plugin:1.1-SNAPSHOT'
    }
}
```

Alternatively, you might choose to include the plugin JAR file. For example:

```groovy
buildscript {
    dependencies {
        classpath files('gradle/liberty-gradle-plugin.jar')
        classpath files('gradle/wlp-anttasks.jar')
    }
}
```
To use the Liberty Gradle Plugin, include the following code in your build script:


```groovy
apply plugin: 'liberty'
```

## Plugin Configuration

See the [Liberty extension properties](docs/libertyExtensions.md#Liberty-extension-properties) reference for the properties used to configure the Liberty plugin. See each task for additional configuration and examples.

## Tasks

The Liberty plugin provides the following tasks for your project:

| Task | Description |
| --------- | ------------ |
| [cleanDirs](docs/clean.md#clean-task) | Cleans the Liberty server logs, workarea, and applications folders.|
| [installLiberty](docs/installLiberty.md#installLiberty-task) | Installs the  Liberty runtime from a repository. |
| [libertyCreate](docs/installCreate.md#libertyCreate-task) | Creates a Liberty server. |
| [installFeature](docs/installFeature.md#installFeature-task) | Installs an additional feature to the WebSphere Liberty runtime. |
| [uninstallFeature](docs/uninstallFeature.md#uninstallfeature-task) | Remove a feature from the WebSphere Liberty runtime. |
| [installApps](docs/installApps.md#installApps-task) | Copy applications generated by the Gradle project to a Liberty server's `dropins` or `apps` directory. The server can be stopped or started for this task. |
| libertyStart | Starts the WebSphere Liberty server in a background process. |
| libertyStop | Stops the WebSphere Liberty server. |
| [libertyRun](docs/libertyRun.md#libertyRun-task) | Runs a WebSphere Liberty server in the Gradle foreground process. |
| [libertyPackage](docs/libertyPackage.md#libertyPackage-task) | Packages a Liberty server. |
| [libertyDump](docs/libertyDump.md#libertyDump-task) | Dumps diagnostic information from the Liberty server into an archive. |
| [libertyJavaDump](docs/libertyJavaDump.md#libertyJavaDump-task) | Dumps diagnostic information from the Liberty server JVM. |
| libertyDebug | Runs the WebSphere Liberty server in the console foreground after a debugger connects to the debug port (default: 7777). |
| libertyStatus | Checks to see if the Liberty server is running. |
| [deploy](docs/deploy.md#deploy-task) | Deploys a supported file to a running Liberty server. |
| [undeploy](docs/undeploy.md#undeploy-task) | Removes an application from the Liberty server. |
