

apply plugin: 'liberty'
apply plugin: 'war'

group = 'liberty.gradle'
version = '1'

ext {
    libertyVersion = project.property("libertyVersion")
    // Liberty server properties
    testServerHttpPort = 9080
    testServerHttpsPort = 9443

    // This is set in the ibm-web-ext.xml file
    warContext = 'sampleJSP.servlet'

    // Liberty server properties
    libertyVersion = project.property("libertyVersion")
}

sourceCompatibility = 1.7
targetCompatibility = 1.7

compileJava.options.encoding = 'UTF-8'

liberty {
    install {
        runtimeUrl = "http://repo1.maven.org/maven2/com/ibm/websphere/appserver/runtime/wlp-webProfile7/${libertyVersion}/wlp-webProfile7-${libertyVersion}.zip"
    }
    server{
        name = 'LibertyProjectServer'
        apps = [war]
        looseApplication = false
        stripVersion = true
    }
    jspCompileTimeout = 35
}

repositories {
    mavenCentral()
}

dependencies {
		testCompile group: 'commons-logging', name: 'commons-logging', version:'1.0.4'
		testCompile group: 'junit', name: 'junit', version:'4.9'
		providedCompile group: 'org.apache.geronimo.specs', name: 'geronimo-servlet_3.0_spec', version:'1.0'
    testCompile 'junit:junit:4.12'
    providedCompile group: 'javax.servlet', name: 'javax.servlet-api', version:'3.1.0'
}

task ('runGradleTest') {
    dependsOn 'clean', 'libertyCreate', 'compileJSP'

    println("  name ${project.name}")
    finalizedBy 'libertyStop'

    doLast {
        assert new File("${projectDir}/src/main/webapp/index.jsp").exists() : 'index.jsp not found!'
        assert new File("${buildDir}/compileJsp").exists() : 'compileJsp Directory not found!'
        assert new File("${buildDir}/classes/java/_index.class").exists() : '_index.class not found!'
    }
}
